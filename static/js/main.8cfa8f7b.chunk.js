(this["webpackJsonpmqtt-monitor"]=this["webpackJsonpmqtt-monitor"]||[]).push([[0],{116:function(e,t,n){e.exports=n(240)},123:function(e,t,n){},126:function(e,t){},128:function(e,t){},192:function(e,t){},194:function(e,t){},209:function(e,t){},210:function(e,t){},212:function(e,t){},214:function(e,t){},222:function(e,t){},224:function(e,t){},240:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),s=n(36),c=n.n(s),i=(n(121),n(122),n(123),n(44)),r=n(32),l=n(100),u=n(101),m=n(114),b=n(102),p=n(115),d=n(103),f=n.n(d),h=function(e,t){window.localStorage.setItem("mqtt_store_item_"+e,JSON.stringify(t))},g=function(e){var t=window.localStorage.getItem("mqtt_store_item_"+e);return t?JSON.parse(t):void 0},E=function(e,t){h(e+"_messages",t)},v=function(e){var t;t=e+"_messages",window.localStorage.removeItem("mqtt_store_item_"+t)},C=n(104),S=n.n(C),y=n(105),k=n.n(y)()(S.a),w=function(e,t,n){k.fire({icon:"success",title:e,text:t,toast:!0,position:"top",timer:n||3e3})},O=function(e,t,n){k.fire({icon:"error",title:e,text:t,toast:!0,position:"top",timer:n||5e3})},j=n(112),F=n(33),x=n(6),N=n(54),P=n.n(N),T=o.a.createContext({isConnected:!1,options:{},topics:new Set}),D=n(106),M=n.n(D),_=n(58),R=n(57),K=n(107),Y=function(e){var t=e.ts;return o.a.createElement("small",null,o.a.createElement(M.a,{format:"YYYY-MM-DD HH:mm:ss",unix:!0},t)," ")},q=function(e){return 0===e?o.a.createElement(K.a,{pill:!0,variant:"danger"},"New!"):null},B=function(e){var t=e.item,n=e.index,a=e.length;return o.a.createElement(_.a.Item,null,o.a.createElement(R.a,null,o.a.createElement(R.a.Body,null,o.a.createElement("strong",{className:"text-primary"},t.topic,": "),o.a.createElement("span",{className:"text-secondary"},t.message),o.a.createElement("small",{className:"pl-2"},"(",a-n,")"),o.a.createElement("span",{className:"pl-2"},o.a.createElement(Y,{ts:t.ts})),o.a.createElement("span",{className:"pl-2"},o.a.createElement(q,{index:n})))))},H=function(e){var t=Object(a.useContext)(T).messages,n=t.map((function(e,n){return o.a.createElement(o.a.Fragment,{key:"item_"+n},o.a.createElement(B,{item:e,index:n,length:t.length}))}));return o.a.createElement(_.a,{variant:"flush"},n)},U=n(15),I=n(19),G=n(113),W=n(16),J=n(7),Q=function(e){return e.isConnected?o.a.createElement(W.a,{className:"btn-block",variant:"danger",type:"submit"},"Disconnect"):o.a.createElement(W.a,{className:"btn-block",variant:"primary",type:"submit"},"Connect")},V=function(e){var t=Object(a.useContext)(T),n=t.isConnected,s=Object(a.useState)(t.options),c=Object(G.a)(s,2),r=c[0],l=c[1],u=function(e){var t=e.target,n=t.name,a=t.value;l(Object.assign({},r,Object(i.a)({},n,a)))};return o.a.createElement(J.a,{onSubmit:function(t){t.preventDefault();var n={host:r.host,username:r.username||null,password:r.password||null};n.host&&e.onConnectFormSubmit&&e.onConnectFormSubmit(n)}},o.a.createElement(J.a.Row,null,o.a.createElement(J.a.Group,{as:x.a,xs:12,md:4,lg:4},o.a.createElement(J.a.Control,{disabled:n,onChange:u,name:"host",type:"text",value:r.host,placeholder:"ws://test.mosquitto.org:8080"})),o.a.createElement(J.a.Group,{as:x.a,xs:6,md:3,lg:3},o.a.createElement(J.a.Control,{disabled:n,onChange:u,name:"username",type:"text",value:r.username,placeholder:"Username"})),o.a.createElement(J.a.Group,{as:x.a,xs:6,md:2,lg:3},o.a.createElement(J.a.Control,{disabled:n,onChange:u,name:"password",type:"password",value:r.password,placeholder:"Password"})),o.a.createElement(x.a,{xs:12,md:3,lg:2},o.a.createElement(Q,{isConnected:n}))))},z=n(110),A=function(e){var t=e.topics,n=e.onTopicClick,a=function(e){n&&n(e.target.textContent)},s=Object(r.a)(t).map((function(e){return o.a.createElement(z.CopyToClipboard,{key:e,text:e},o.a.createElement(W.a,{onClick:a,variant:"outline-success",className:"mr-2",size:"sm"},e))}));return o.a.createElement("p",{className:"m-0 p-0"},o.a.createElement("strong",null,"Subscribed Topics:"),s)},$=function(e){var t=Object(a.useContext)(T),n=t.isConnected,s=t.topics,c=Object(a.useRef)(null),i=Object(a.useRef)(null),r=function(t){var n={subscribe:!0,topics:c.current.value};console.log("SubscribeForm.handleClick1 ",n),n.topics&&e.onSubscribeFormSubmit&&e.onSubscribeFormSubmit(n),c.current.value=""},l=function(t){var n={subscribe:!1,topics:i.current.value};console.log("SubscribeForm.handleClick2 ",n),n.topics&&e.onSubscribeFormSubmit&&e.onSubscribeFormSubmit(n),i.current.value=""},u=function(e){"Enter"===e.key&&(e.preventDefault(),e.target===c.current?r():e.target===i.current&&l())};return o.a.createElement(o.a.Fragment,null,o.a.createElement(J.a,null,o.a.createElement(J.a.Row,{className:"align-items-center"},o.a.createElement(x.a,{as:x.a,sm:6,md:3,className:"mb-3 mt-3"},o.a.createElement(J.a.Control,{onKeyUp:u,ref:c,name:"subscribe-topics",type:"text",placeholder:"topic/test"})),o.a.createElement(x.a,{sm:6,md:3},o.a.createElement(W.a,{className:"btn-block",name:"subscribe",variant:"primary",type:"button",disabled:!n,onClick:r},"Subscribe")),o.a.createElement(x.a,{sm:6,md:3,className:"mb-3 mt-3"},o.a.createElement(J.a.Control,{onKeyUp:u,ref:i,name:"unsubscribe-topics",type:"text",placeholder:"topic/test"})),o.a.createElement(x.a,{sm:6,md:3},o.a.createElement(W.a,{className:"btn-block",name:"unsubscribe",variant:"danger",type:"button",disabled:!n,onClick:l},"Unsubscibe")))),o.a.createElement(A,{topics:s,onTopicClick:function(e){console.log("onTopicClick",e),i.current.value=e}}))},L=function(e){var t=Object(a.useContext)(T),n=t.isConnected,s=t.topics,c=Object(a.useRef)(null),i=Object(a.useRef)(null);return o.a.createElement(o.a.Fragment,null,o.a.createElement(J.a,{onSubmit:function(t){t.preventDefault();var n={topic:c.current.value,message:i.current.value,callback:function(e){e||(i.current.value="")},isValid:function(){return n.topic&&n.message}};n.isValid()&&e.onPublishFormSubmit&&e.onPublishFormSubmit(n)}},o.a.createElement(J.a.Row,null,o.a.createElement(J.a.Group,{as:x.a,xs:12,md:3},o.a.createElement(J.a.Control,{ref:c,name:"publish-topic",type:"text",placeholder:"topic name"})),o.a.createElement(J.a.Group,{as:x.a,xs:12,md:7},o.a.createElement(J.a.Control,{ref:i,name:"publish-message",type:"text",placeholder:"message content"})),o.a.createElement(x.a,{xs:12,md:2},o.a.createElement(W.a,{className:"btn-block",name:"publish",variant:"primary",type:"submit",disabled:!n},"Publish")))),o.a.createElement(A,{topics:s,onTopicClick:function(e){console.log("onTopicClick",e),c.current.value=e}}))};var X=function(e){return o.a.createElement(I.a,{defaultActiveKey:"0",className:"w-100"},o.a.createElement(U.a,null,o.a.createElement(I.a.Toggle,{as:U.a.Header,className:"bg-dark",eventKey:"0"},o.a.createElement("span",{className:"text-white"}," Connect Options")),o.a.createElement(I.a.Collapse,{eventKey:"0"},o.a.createElement(U.a.Body,null,o.a.createElement(V,{onConnectFormSubmit:e.onConnectFormSubmit})))),o.a.createElement(U.a,null,o.a.createElement(I.a.Toggle,{as:U.a.Header,className:"bg-dark",eventKey:"1"},o.a.createElement("span",{className:"text-white"}," Subscribe Options")),o.a.createElement(I.a.Collapse,{eventKey:"1"},o.a.createElement(U.a.Body,null,o.a.createElement($,{onSubscribeFormSubmit:e.onSubscribeFormSubmit})))),o.a.createElement(U.a,null,o.a.createElement(I.a.Toggle,{as:U.a.Header,className:"bg-dark",eventKey:"2"},o.a.createElement("span",{className:"text-white"}," Publish Options")),o.a.createElement(I.a.Collapse,{eventKey:"2"},o.a.createElement(U.a.Body,null,o.a.createElement(L,{onPublishFormSubmit:e.onPublishFormSubmit})))))};function Z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var ee={host:"ws://test.mosquitto.org:8080",username:null,password:null},te=function(e){function t(e){var n;Object(l.a)(this,t),(n=Object(m.a)(this,Object(b.a)(t).call(this,e))).onClearClick=function(){n.setState({messages:[]},(function(){v(n.state.options.host)}))},n.onConnectFormSubmit=function(e){console.log("onConnectFormSubmit ",e),n.state.isConnected?n.client.end():e&&e.host&&n.connect(e)},n.onSubscribeFormSubmit=function(e){console.log("onSubscribeFormSubmit ",e);var t=e.subscribe,a=e.topics;if(n.state.isConnected&&a){var o=a.split(" ");t?n.subscribe(o):n.unsubscribe(o)}},n.onPublishFormSubmit=function(e){console.log("onPublishFormFormSubmit ",e);var t=e.topic,a=e.message;t.includes("#")||t.includes("*")?O("Invalid Topics","Can not publish to wildcard topics"):n.state.isConnected&&t&&a&&n.publish(t,a,e.callback)};var a=g("options")||ee;return n.state={isConnected:!1,needReconnect:!1,options:a,topics:new Set,messages:[]},n}return Object(p.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){var e=this.state.messages,t=e&&e.length>0;return o.a.createElement(T.Provider,{value:this.state},o.a.createElement(j.a,null,o.a.createElement(F.a,{className:"justify-content-center"},o.a.createElement("h1",{className:"p-3",as:x.a},"MQTT Monitor")),o.a.createElement(F.a,null,o.a.createElement(X,{onConnectFormSubmit:this.onConnectFormSubmit,onSubscribeFormSubmit:this.onSubscribeFormSubmit,onPublishFormSubmit:this.onPublishFormSubmit})),o.a.createElement(F.a,{className:"m-3"},o.a.createElement("h3",{as:x.a},"Received Messages")),o.a.createElement(F.a,null,o.a.createElement(H,null)),o.a.createElement(F.a,{className:"justify-content-end p-3"},t?o.a.createElement(W.a,{as:x.a,md:3,lg:2,onClick:this.onClearClick,variant:"outline-dark"},"Clear Messages"):null)))}},{key:"cleanTopics",value:function(e){var t,n;return n=e,"[object String]"===Object.prototype.toString.call(n)?t=e.split(" "):function(e){return null!=e&&"function"===typeof e[Symbol.iterator]}(e)&&(t=e),t.map((function(e){return e.trim()})).filter(Boolean)}},{key:"publish",value:function(e,t,n){console.log("publish",e,t),this.client.publish(e,t,(function(a){a?console.log("publish fail:",a):(console.log("published:",e,t),w("Message Sent","message is sent to "+e)),n&&n(a)}))}},{key:"unsubscribe",value:function(e,t){var n=this,a=this.cleanTopics(e);console.log("unsubscribe to",a),this.client.unsubscribe(a,(function(e){if(e)console.error("unsubscribe fail:",e);else{console.log("unsubscribed to",a);var o=n.state.topics;a.forEach((function(e){o.delete(e)})),n.setState({topics:o})}t&&t(e)}))}},{key:"subscribe",value:function(e,t){var n=this,a=this.cleanTopics(e);console.log("subscribe to",a),this.client.subscribe(a,null,(function(e,o){e?(console.error("subscribe fail:",e),O("Subscribe Failed",e)):(console.log("subscribed to",o),n.setState({topics:new Set([].concat(Object(r.a)(a),Object(r.a)(n.state.topics)))}),w("Subscribe Success","subscribed topics: "+a)),t&&t(e,o)}))}},{key:"disconnect",value:function(){this.state.isConnected&&this.client.end((function(){console.log("disconnect end")}))}},{key:"onConnected",value:function(e){var t,n=this;console.log("connected to",e),w("MQTT Connected!","server is "+e.host),h("options",e),this.setState({isConnected:this.client.connected,options:e,messages:(t=e.host,g(t+"_messages")||[])},(function(){n.subscribe("pump/# monitor/#",(function(e){if(!e){var t=P()().format("YYYY-MM-DD HH:mm:ss");n.client.publish("monitor/log","Monitor online at ".concat(t,"!"))}}))}))}},{key:"connect",value:function(e){var t=this,n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Z(n,!0).forEach((function(t){Object(i.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{reconnectPeriod:0});console.log("connecting with",n),this.client=f.a.connect(e.host,n),this.client.on("connect",(function(){t.onConnected(n)})),this.client.on("disconnect",(function(){console.log("disconnect"),t.setState({isConnected:t.client.connected})})),this.client.on("reconnect",(function(){console.log("reconnect")})),this.client.on("offline",(function(){console.log("offline")})),this.client.on("close",(function(){console.log("close"),t.setState({isConnected:t.client.connected})})),this.client.on("error",(function(e){console.log("Ooops","Something is wrong!",e),t.setState({isConnected:t.client.connected})})),this.client.stream.on("error",(function(e){console.error("Connection error:",e),O("Connection Error!","Failed to connect to "+n.host)})),this.client.on("message",(function(e,n){t.setState({messages:[{ts:Math.round(Date.now()/1e3),topic:e,message:n.toString()}].concat(Object(r.a)(t.state.messages))},(function(){E(t.state.options.host,t.state.messages),console.log("total messages count: "+t.state.messages.length)}))}))}},{key:"checkConnect",value:function(){var e=this.state.options;e.host&&e.host.startsWith("ws")&&this.connect(e)}},{key:"componentDidMount",value:function(){console.log("componentDidMount",this.state.options)}},{key:"componentDidUpdate",value:function(){this.state.needReconnect&&this.checkConnect()}},{key:"componentWillUnmount",value:function(){console.log("componentWillUnmount"),this.state.isConnected&&h("options",this.state.options),E(this.state.options.host,this.state.messages)}}]),t}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(o.a.createElement(te,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[116,1,2]]]);
//# sourceMappingURL=main.8cfa8f7b.chunk.js.map