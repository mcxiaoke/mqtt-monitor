(this["webpackJsonpmqtt-monitor"]=this["webpackJsonpmqtt-monitor"]||[]).push([[0],{116:function(e,t,n){e.exports=n(240)},123:function(e,t,n){},126:function(e,t){},128:function(e,t){},192:function(e,t){},194:function(e,t){},209:function(e,t){},210:function(e,t){},212:function(e,t){},214:function(e,t){},222:function(e,t){},224:function(e,t){},240:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),c=n(35),s=n.n(c),r=(n(121),n(122),n(123),n(44)),l=n(32),i=n(100),u=n(101),m=n(114),b=n(102),p=n(115),f=n(103),d=n.n(f),h={storeSet:function(e,t){window.localStorage.setItem("mqtt_store_item_"+e,JSON.stringify(t))},storeGet:function(e){var t=window.localStorage.getItem("mqtt_store_item_"+e);return t?JSON.parse(t):void 0}},g=function(e){return null!=e&&"function"===typeof e[Symbol.iterator]},E=function(e){return"[object String]"===Object.prototype.toString.call(e)},v=n(112),S=n(36),y=n(7),C=n(54),O=n.n(C),w=o.a.createContext({isConnected:!1,options:{},topics:new Set}),k=n(104),j=n.n(k),F=n(58),x=n(57),N=n(105),P=function(e){return e?o.a.createElement("small",null,o.a.createElement(j.a,{format:"YYYY/MM/DD HH:mm:ss"},e)," "):null},T=function(e){return 0===e?o.a.createElement(N.a,{pill:!0,variant:"danger"},"New!"):null},D=function(e){var t=e.item,n=e.index,a=e.length;return o.a.createElement(F.a.Item,null,o.a.createElement(x.a,null,o.a.createElement(x.a.Body,null,o.a.createElement("strong",{className:"text-primary"},t.topic,": "),o.a.createElement("span",{className:"text-secondary"},t.message),o.a.createElement("small",{className:"pl-2"},"(",a-n,")"),o.a.createElement("span",{className:"pl-2"},o.a.createElement(P,{ts:t.ts})),o.a.createElement("span",{className:"pl-2"},o.a.createElement(T,{index:n})))))},M=function(e){var t=Object(a.useContext)(w).messages,n=t.map((function(e,n){return o.a.createElement(o.a.Fragment,{key:"item_"+n},o.a.createElement(D,{item:e,index:n,length:t.length}))}));return o.a.createElement(F.a,{variant:"flush"},n)},_=n(15),K=n(19),G=n(113),H=n(18),R=n(6),Y=function(e){return e.isConnected?o.a.createElement(H.a,{className:"btn-block",variant:"danger",type:"submit"},"Disconnect"):o.a.createElement(H.a,{className:"btn-block",variant:"primary",type:"submit"},"Connect")},B=function(e){var t=Object(a.useContext)(w),n=t.isConnected,c=Object(a.useState)(t.options),s=Object(G.a)(c,2),l=s[0],i=s[1],u=function(e){var t=e.target,n=t.name,a=t.value;i(Object.assign({},l,Object(r.a)({},n,a)))};return o.a.createElement(R.a,{onSubmit:function(t){t.preventDefault();var n={host:l.host,username:l.username||null,password:l.password||null};n.host&&e.onConnectFormSubmit&&e.onConnectFormSubmit(n)}},o.a.createElement(R.a.Row,null,o.a.createElement(R.a.Group,{as:y.a,xs:12,md:4,lg:4},o.a.createElement(R.a.Control,{disabled:n,onChange:u,name:"host",type:"text",value:l.host,placeholder:"ws://test.mosquitto.org:8080"})),o.a.createElement(R.a.Group,{as:y.a,xs:6,md:3,lg:3},o.a.createElement(R.a.Control,{disabled:n,onChange:u,name:"username",type:"text",value:l.username,placeholder:"Username"})),o.a.createElement(R.a.Group,{as:y.a,xs:6,md:2,lg:3},o.a.createElement(R.a.Control,{disabled:n,onChange:u,name:"password",type:"password",value:l.password,placeholder:"Password"})),o.a.createElement(y.a,{xs:12,md:3,lg:2},o.a.createElement(Y,{isConnected:n}))))},q=n(108),U=function(e){var t=e.topics,n=e.onTopicClick,a=function(e){n&&n(e.target.textContent)},c=Object(l.a)(t).map((function(e){return o.a.createElement(q.CopyToClipboard,{key:e,text:e},o.a.createElement(H.a,{onClick:a,variant:"outline-success",className:"mr-2",size:"sm"},e))}));return o.a.createElement("p",{className:"m-0 p-0"},o.a.createElement("strong",null,"Subscribed Topics:"),c)},W=function(e){var t=Object(a.useContext)(w),n=t.isConnected,c=t.topics,s=Object(a.useRef)(null),r=Object(a.useRef)(null),l=function(t){var n={subscribe:!0,topics:s.current.value};console.log("SubscribeForm.handleClick1 ",n),n.topics&&e.onSubscribeFormSubmit&&e.onSubscribeFormSubmit(n),s.current.value=""},i=function(t){var n={subscribe:!1,topics:r.current.value};console.log("SubscribeForm.handleClick2 ",n),n.topics&&e.onSubscribeFormSubmit&&e.onSubscribeFormSubmit(n),r.current.value=""},u=function(e){"Enter"===e.key&&(e.preventDefault(),e.target===s.current?l():e.target===r.current&&i())};return o.a.createElement(o.a.Fragment,null,o.a.createElement(R.a,null,o.a.createElement(R.a.Row,{className:"align-items-center"},o.a.createElement(y.a,{as:y.a,sm:6,md:3,className:"mb-3 mt-3"},o.a.createElement(R.a.Control,{onKeyUp:u,ref:s,name:"subscribe-topics",type:"text",placeholder:"topic/test"})),o.a.createElement(y.a,{sm:6,md:3},o.a.createElement(H.a,{className:"btn-block",name:"subscribe",variant:"primary",type:"button",disabled:!n,onClick:l},"Subscribe")),o.a.createElement(y.a,{sm:6,md:3,className:"mb-3 mt-3"},o.a.createElement(R.a.Control,{onKeyUp:u,ref:r,name:"unsubscribe-topics",type:"text",placeholder:"topic/test"})),o.a.createElement(y.a,{sm:6,md:3},o.a.createElement(H.a,{className:"btn-block",name:"unsubscribe",variant:"danger",type:"button",disabled:!n,onClick:i},"Unsubscibe")))),o.a.createElement(U,{topics:c,onTopicClick:function(e){console.log("onTopicClick",e),r.current.value=e}}))},I=function(e){var t=Object(a.useContext)(w),n=t.isConnected,c=t.topics,s=Object(a.useRef)(null),r=Object(a.useRef)(null);return o.a.createElement(o.a.Fragment,null,o.a.createElement(R.a,{onSubmit:function(t){t.preventDefault();var n={topic:s.current.value,message:r.current.value,callback:function(e){e||(r.current.value="")},isValid:function(){return n.topic&&n.message}};n.isValid()&&e.onPublishFormSubmit&&e.onPublishFormSubmit(n)}},o.a.createElement(R.a.Row,null,o.a.createElement(R.a.Group,{as:y.a,xs:12,md:3},o.a.createElement(R.a.Control,{ref:s,name:"publish-topic",type:"text",placeholder:"topic name"})),o.a.createElement(R.a.Group,{as:y.a,xs:12,md:7},o.a.createElement(R.a.Control,{ref:r,name:"publish-message",type:"text",placeholder:"message content"})),o.a.createElement(y.a,{xs:12,md:2},o.a.createElement(H.a,{className:"btn-block",name:"publish",variant:"primary",type:"submit",disabled:!n},"Publish")))),o.a.createElement(U,{topics:c,onTopicClick:function(e){console.log("onTopicClick",e),s.current.value=e}}))};var J=function(e){return o.a.createElement(K.a,{defaultActiveKey:"0",className:"w-100"},o.a.createElement(_.a,null,o.a.createElement(K.a.Toggle,{as:_.a.Header,className:"bg-dark",eventKey:"0"},o.a.createElement("span",{className:"text-white"}," Connect Options")),o.a.createElement(K.a.Collapse,{eventKey:"0"},o.a.createElement(_.a.Body,null,o.a.createElement(B,{onConnectFormSubmit:e.onConnectFormSubmit})))),o.a.createElement(_.a,null,o.a.createElement(K.a.Toggle,{as:_.a.Header,className:"bg-dark",eventKey:"1"},o.a.createElement("span",{className:"text-white"}," Subscribe Options")),o.a.createElement(K.a.Collapse,{eventKey:"1"},o.a.createElement(_.a.Body,null,o.a.createElement(W,{onSubscribeFormSubmit:e.onSubscribeFormSubmit})))),o.a.createElement(_.a,null,o.a.createElement(K.a.Toggle,{as:_.a.Header,className:"bg-dark",eventKey:"2"},o.a.createElement("span",{className:"text-white"}," Publish Options")),o.a.createElement(K.a.Collapse,{eventKey:"2"},o.a.createElement(_.a.Body,null,o.a.createElement(I,{onPublishFormSubmit:e.onPublishFormSubmit})))))},Q=n(110),V=n.n(Q),z=n(111);function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var $={host:"ws://test.mosquitto.org:8080",username:null,password:null},L=(n.n(z)()(V.a),function(e){function t(e){var n;Object(i.a)(this,t),(n=Object(m.a)(this,Object(b.a)(t).call(this,e))).onConnectFormSubmit=function(e){console.log("onConnectFormSubmit ",e),n.state.isConnected?n.client.end():e&&e.host&&n.connect(e)},n.onSubscribeFormSubmit=function(e){console.log("onSubscribeFormSubmit ",e);var t=e.subscribe,a=e.topics;if(n.state.isConnected&&a){var o=a.split(" ");t?n.subscribe(o):n.unsubscribe(o)}},n.onPublishFormSubmit=function(e){console.log("onPublishFormFormSubmit ",e);var t=e.topic,a=e.message;n.state.isConnected&&t&&a&&n.publish(t,a,e.callback)};var a=h.storeGet("options")||$,o=a&&h.storeGet(a+"_messages")||[];return n.state={isConnected:!1,options:a,topics:new Set,messages:o},n}return Object(p.a)(t,e),Object(u.a)(t,[{key:"render",value:function(){return o.a.createElement(w.Provider,{value:this.state},o.a.createElement(v.a,null,o.a.createElement(S.a,{className:"justify-content-center"},o.a.createElement("h1",{className:"p-3",as:y.a},"MQTT Monitor")),o.a.createElement(S.a,null,o.a.createElement(J,{onConnectFormSubmit:this.onConnectFormSubmit,onSubscribeFormSubmit:this.onSubscribeFormSubmit,onPublishFormSubmit:this.onPublishFormSubmit})),o.a.createElement(S.a,null,o.a.createElement(y.a,{className:"mt-3"},o.a.createElement("h3",null,"Received Messages"))),o.a.createElement(S.a,null,o.a.createElement(M,null))))}},{key:"cleanTopics",value:function(e){var t;return E(e)?t=e.split(" "):g(e)&&(t=e),t.map((function(e){return e.trim()})).filter(Boolean)}},{key:"publish",value:function(e,t,n){console.log("publish",e,t),this.client.publish(e,t,(function(a){a?console.log("publish fail:",a):console.log("published:",e,t),n&&n(a)}))}},{key:"unsubscribe",value:function(e,t){var n=this,a=this.cleanTopics(e);console.log("unsubscribe to",a),this.client.unsubscribe(a,(function(e){if(e)console.error("unsubscribe fail:",e);else{console.log("unsubscribed to",a);var o=n.state.topics;a.forEach((function(e){o.delete(e)})),n.setState({topics:o})}t&&t(e)}))}},{key:"subscribe",value:function(e,t){var n=this,a=this.cleanTopics(e);console.log("subscribe to",a),this.client.subscribe(a,(function(e,o){e?console.error("subscribe fail:",e):(console.log("subscribed to",o),n.setState({topics:new Set([].concat(Object(l.a)(a),Object(l.a)(n.state.topics)))})),t&&t(e,o)}))}},{key:"disconnect",value:function(){this.state.isConnected&&this.client.end()}},{key:"connect",value:function(e){var t=this,n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(n,!0).forEach((function(t){Object(r.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{reconnectPeriod:5e3});console.log("connecting with",n),this.client=d.a.connect(e.host,n),this.client.on("connect",(function(){console.log("connected to",n.host),h.storeSet("options",n),t.setState({isConnected:t.client.connected,options:n}),t.subscribe("pump/# monitor/#",(function(e){if(!e){var n=O()().format("YYYY/MM/DD HH:mm:ss");t.client.publish("monitor/log","Hello, MQTT Monitor is online at ".concat(n,"!"))}}))})),this.client.on("disconnect",(function(){console.log("disconnect"),t.setState({isConnected:t.client.connected})})),this.client.on("reconnect",(function(){console.log("reconnect")})),this.client.on("offline",(function(){console.log("offline")})),this.client.on("close",(function(){console.log("close"),t.setState({isConnected:t.client.connected})})),this.client.on("error",(function(e){console.log("Ooops","Something is wrong!",e),t.setState({isConnected:t.client.connected})})),this.client.on("message",(function(e,n,a){t.setState({messages:[{ts:new Date,topic:e,message:n.toString()}].concat(Object(l.a)(t.state.messages))},(function(){h.storeSet(t.state.options+"_messages",t.state.messages),console.log("total messages count: "+t.state.messages.length)}))}))}},{key:"checkConnect",value:function(){var e=this.state.options;e.host&&e.host.startsWith("ws")&&this.connect(e)}},{key:"componentDidMount",value:function(){console.log("componentDidMount",this.state.options)}},{key:"componentWillUnmount",value:function(){console.log("componentWillUnmount"),this.state.isConnected&&h.storeSet("options",this.state.options),h.storeSet(this.state.options+"_messages",this.state.messages)}}]),t}(o.a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(L,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[116,1,2]]]);
//# sourceMappingURL=main.6124d7b3.chunk.js.map